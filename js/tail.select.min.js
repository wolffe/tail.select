/**
 *  tail.select - The vanilla JavaScript solution to make your <select> fields awesome!
 *
 *  @author     Ciprian Popescu <getbutterfly@gmail.com>
 *  @version    1.0.2
 *  @url        https://getbutterfly.com/tail-select/
 *  @github     https://github.com/wolffe/tail.select.js
 *  @license    MIT License
 *  @copyright  Copyright 2020 - 2024 Ciprian Popescu <getbutterfly@gmail.com>
 */
const tail={select:function(n,t={}){const r={...{multiTags:!1,multiLimit:Infinity,minSelectionLimit:0,multiCounter:!0,theme:"light",classNames:"tail-default",strings:{all:"All",none:"None",placeholder:"Select an option...",search:"Type in to search...",limitExceded:"You can only select {0} options!",minimumReached:"You need to select at least {0} options!"}},...t},{multiLimit:u,minSelectionLimit:f,strings:i}=r;i!=null&&(i.limitExceded!=null&&u<Infinity&&(i.limitExceded=i.limitExceded.replace("{0}",u)),i.minimumReached!=null&&f>0&&(i.minimumReached=i.minimumReached.replace("{0}",f)));const e=document.querySelectorAll(n);e.forEach(n=>{function g(){const r=document.createDocumentFragment(),i=n.getElementsByTagName("optgroup");if(i.length>0)for(let t=0;t<i.length;t++){const e=i[t],u=document.createElement("div");u.classList.add("tail--optgroup");const s=document.createElement("label"),r=document.createElement("input");r.type="checkbox";r.value=e.label;r.addEventListener("change",()=>rt(r));s.appendChild(r);const h=document.createElement("span");h.textContent=e.label;h.classList.add("tail--optgroup-label");s.appendChild(h);u.appendChild(s);const f=document.createElement("div");f.setAttribute("role","listbox");f.classList.add("tail--nested-dropdown-list");const c=e.getElementsByTagName("option");for(let t=0;t<c.length;t++){const i=c[t],u=document.createElement("div");u.classList.add("tail--nested-dropdown-item");const r=document.createElement("input");r.type="checkbox";r.value=i.textContent;const e=document.createElement("label"),o=document.createElement("span");o.textContent=i.textContent;i.dataset.description&&(o.innerHTML+=`<small>${i.dataset.description}</small>`);i.selected&&i.hasAttribute("selected")&&(r.checked=!0,d(n),k(n));e.appendChild(r);e.appendChild(o);u.appendChild(e);f.appendChild(u)}u.appendChild(f);o.appendChild(u)}else{const t=n.getElementsByTagName("option");for(let i=0;i<t.length;i++){const r=t[i],f=document.createElement("div");f.classList.add("tail--nested-dropdown-item");const u=document.createElement("input");u.type="checkbox";u.value=r.textContent;const e=document.createElement("label"),s=document.createElement("span");s.textContent=r.textContent;r.dataset.description&&(s.innerHTML+=`<small>${r.dataset.description}</small>`);r.selected&&r.hasAttribute("selected")&&(u.checked=!0,d(n),k(n));e.appendChild(u);e.appendChild(s);f.appendChild(e);o.appendChild(f)}}t.setAttribute("role","combobox");t.setAttribute("aria-haspopup","true");t.setAttribute("aria-expanded","false");ut();o.appendChild(r)}function nt(n,t){if(n.options.length>u){w(i.limitExceded||`You can only select ${u} options!`);return}const r=t.checked,f=o.querySelectorAll('input[type="checkbox"]');f.forEach(t=>{t.checked=r,s(n,t)})}function tt(n){const i=o.querySelectorAll('input[type="checkbox"]');i.forEach(t=>{t.checked=!1,s(n,t)});const t=n.getElementsByTagName("option");for(let n=0;n<t.length;n++)t[n].selected=!1}function p(t){if(n.multiple){if(it(t.checked)){t.checked=!t.checked;y();const r=n.selectedOptions.length>=u?i.limitExceded||`You can only select ${u} options!`:i.minimumReached||`You need to select at least ${f} options!`;w(r);return}s(n,t)}else{const i=o.querySelectorAll('.tail--nested-dropdown-item input[type="checkbox"]');i.forEach(n=>n.checked=!1);t.checked=!0;s(n,t)}}function it(t){return t?n.selectedOptions.length>=u:n.selectedOptions.length==f}function w(n){const i=document.createElement("p");i.classList.add("mt-2","text-sm","text-red-600");i.textContent=n;t.parentNode.appendChild(i);setTimeout(()=>{t.parentNode.removeChild(i)},2e3)}function rt(t){const i=t.checked,r=t.closest(".tail--optgroup").querySelector(".tail--nested-dropdown-list"),u=r.querySelectorAll('input[type="checkbox"]');if(u.forEach(n=>{n.checked=i,p(n)}),!n.multiple){const i=n.closest(".tail-select");if(i){const r=i.querySelectorAll('.tail--nested-dropdown-item input[type="checkbox"]');r.forEach(i=>{i!==t&&(i.checked=!1,s(n,i))})}}s(n,t)}function ut(){const n=o.querySelectorAll('.tail--nested-dropdown-item input[type="checkbox"]');n.forEach(n=>{n.addEventListener("change",()=>p(n))})}function s(n,t){var o,s,u;const h=t.value,f=Array.from(n.options).find(n=>n.value===h||n.textContent===h);if(f){f.selected=t.checked?!0:!1;const i=new Event("change",{bubbles:!0});n.dispatchEvent(i)}const i=Array.from(n.options).filter(n=>n.selected);e.value=n.multiple?i.map(n=>n.textContent).join(", "):i.length>0&&e?i[0].textContent:"";r.multiTags&&n.multiple&&b(v,i);const c=i.map(n=>n.value);for(o=n.options,s=0,u=0;u<o.length;u++)o[u].selected&&s++;if(r.multiCounter){let t=n.id;if(t){let n=document.querySelector(`.${t}`).querySelector(".tail--counter");n&&(n.textContent=s)}}}function ft(n,t){const r=t.value.trim().toLowerCase(),i=o.querySelectorAll("div");i.forEach(n=>{const t=n.querySelector('input[type="checkbox"]'),i=t.nextElementSibling.textContent.toLowerCase(),u=n.closest("div");t.style.display=i.includes(r)?"inline-block":"none"});i.forEach(n=>{const t=n.querySelector('input[type="checkbox"]'),i=n.closest("div"),r=n.querySelectorAll('div input[type="checkbox"]:not([style="display: none;"])'),u=r.length>0;i.style.display=t.style.display==="inline-block"||u?"block":"none"})}function b(n,t){n.innerHTML="";t.forEach(t=>{const i=document.createElement("li");i.textContent=t.textContent;n.appendChild(i)})}function k(n){const t=Array.from(n.options).filter(n=>n.selected&&n.hasAttribute("selected"));e.value=n.multiple?t.map(n=>n.textContent).join(", "):t.length>0&&e?t[0].textContent:"";r.multiTags&&n.multiple&&b(v,t)}function d(n){let t=n.id;if(t){let i=document.querySelector(`.${t}`).querySelector(".tail--counter");if(i){const t=Array.from(n.options).filter(n=>n.selected).length;i.textContent=t}}}function et(){o.style.display="block";t.setAttribute("aria-expanded","true")}function y(){o.style.display="none";t.setAttribute("aria-expanded","false")}function ot(n){t.contains(n.target)||y()}function st(n){n.key==="Escape"&&y()}n.style.display="none";const t=document.createElement("div");t.classList.add("tail-select");t.classList.add(n.id);t.classList.add(r.classNames);t.dataset.theme=`tail-theme--${r.theme}`;n.multiple?t.classList.add("tail--multiple"):t.classList.add("tail--single");const e=document.createElement("input");e.type="text";e.classList.add("tail--search");e.placeholder=i.placeholder||"Select an option...";e.addEventListener("focus",()=>{e.placeholder=i.search||"Type in to search..."});e.addEventListener("blur",()=>{e.placeholder=i.placeholder||"Select an option..."});e.addEventListener("input",()=>ft(n,e));const l=document.createElement("div");l.classList.add("tail--toolbar");const h=document.createElement("input");h.type="checkbox";h.value=i.all||"All";h.addEventListener("change",()=>nt(n,h));const a=document.createElement("label");a.textContent=i.all||"All";a.classList.add("all");a.appendChild(h);const c=document.createElement("button");if(c.type="button",c.textContent=i.none||"None",c.classList.add("uncheck"),c.addEventListener("click",()=>tt(n)),r.multiCounter){const n=document.createElement("span");n.textContent="0";n.classList.add("tail--counter");t.appendChild(n)}const o=document.createElement("div");o.classList.add("tail--nested-dropdown");o.style.display="none";t.appendChild(e);t.appendChild(l);t.appendChild(o);l.appendChild(a);l.appendChild(c);n.insertAdjacentElement("afterend",t);const v=document.createElement("ul");v.classList.add("tail--selected-options-list");r.multiTags&&n.multiple&&t.insertAdjacentElement("afterend",v);e.addEventListener("focus",et);document.addEventListener("click",ot);document.addEventListener("keydown",st);g()})}};